# Tema 4: Framework Express

## √çndice

1. [Introducci√≥n a Express](#1-introducci√≥n-a-express)
2. [Configuraci√≥n del Proyecto](#2-configuraci√≥n-del-proyecto)
3. [Primera Aplicaci√≥n Express 5](#3-primera-aplicaci√≥n-express-5)
4. [Routing en Express 5](#4-routing-en-express-5)
5. [CRUD Completo](#5-crud-completo)
6. [Routers Modulares](#6-routers-modulares)
7. [Middleware](#7-middleware)
8. [Validaci√≥n con Zod](#8-validaci√≥n-con-zod)
9. [Manejo de Errores](#9-manejo-de-errores)
10. [Validaci√≥n de Entorno](#10-validaci√≥n-de-entorno)
11. [Archivos Est√°ticos y Logging](#11-archivos-est√°ticos-y-logging)
12. [Migraci√≥n de Express 4 a Express 5](#12-migraci√≥n-de-express-4-a-express-5)

---

## 1. Introducci√≥n a Express

### 1.1 ¬øQu√© es Express?

Express es el framework web m√°s popular para Node.js. Simplifica la creaci√≥n de servidores HTTP proporcionando una API intuitiva para routing, middleware y manejo de solicitudes/respuestas.

**Caracter√≠sticas principales:**

- **Routing declarativo**: Define rutas de forma clara y organizada
- **Middleware**: Sistema flexible para procesar solicitudes
- **Alto rendimiento**: Capa m√≠nima sobre Node.js
- **Extensible**: Gran ecosistema de middleware y plugins
- **Maduro**: +15 a√±os de desarrollo, comunidad enorme

### 1.2 Express 5: La Nueva Era

**Express 5.0.0 se lanz√≥ oficialmente en septiembre de 2024** despu√©s de 10 a√±os de desarrollo. Express 5.1+ es la versi√≥n recomendada en 2025.

**Principales mejoras:**

| Caracter√≠stica | Express 4 | Express 5 |
|----------------|-----------|-----------|
| Manejo de async | Manual (try/catch) | **Autom√°tico** |
| Versi√≥n Node.js | 0.10+ | **18+** |
| Sintaxis rutas | `/:param?`, `/*` | `{/:param}`, `/*splat` |
| `app.del()` | Disponible | **Eliminado** (usar `app.delete()`) |
| Promesas | Rechazos no capturados | **Captura autom√°tica** |

**La mejora m√°s importante**: Express 5 captura autom√°ticamente los errores de funciones async, eliminando la necesidad de `try/catch` o wrappers como `express-async-handler`.

```javascript
// Express 4 - Necesitaba try/catch manual
app.get('/users/:id', async (req, res, next) => {
  try {
    const user = await getUserById(req.params.id);
    res.json(user);
  } catch (error) {
    next(error); // Pasar error al middleware
  }
});

// Express 5 - Manejo autom√°tico
app.get('/users/:id', async (req, res) => {
  const user = await getUserById(req.params.id);
  res.json(user);
  // Los errores se capturan autom√°ticamente
});
```

---

## 2. Configuraci√≥n del Proyecto

### 2.1 Inicializaci√≥n con ESM

```bash
mkdir mi-api && cd mi-api
npm init -y
```

Edita `package.json`:

```json
{
  "name": "mi-api",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "node --watch --env-file=.env src/index.js",
    "start": "node --env-file=.env src/index.js"
  },
  "engines": {
    "node": ">=20.11.0"
  }
}
```

### 2.2 Instalar Dependencias

```bash
# Express 5
npm install express@5

# Dependencias comunes
npm install zod helmet cors
```

### 2.3 Variables de Entorno

Crea el archivo `.env`:

```env
NODE_ENV=development
PORT=3000
DATABASE_URL=mongodb://localhost:27017/miapp
JWT_SECRET=tu_secreto_super_seguro_minimo_32_caracteres
```

> üí° **Node.js 20.6+** soporta `.env` de forma nativa con `--env-file=.env`, sin necesidad del paquete `dotenv`.

**No olvides a√±adir `.env` a `.gitignore`:**

```gitignore
node_modules/
.env
.env.local
```

### 2.4 Estructura de Proyecto

```
mi-api/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js           # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ app.js             # Configuraci√≥n Express
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ env.js         # Validaci√≥n de variables de entorno
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js       # Agregador de rutas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cursos.routes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarios.routes.js
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cursos.controller.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarios.controller.js
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validateRequest.js
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cursos.schema.js
‚îÇ   ‚îî‚îÄ‚îÄ data/
‚îÇ       ‚îî‚îÄ‚îÄ cursos.js      # Datos de ejemplo
‚îú‚îÄ‚îÄ .env
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ package.json
```

---

## 3. Primera Aplicaci√≥n Express 5

> üìÇ **C√≥digo de ejemplo**: [`codigo/T4/src/app.js`](../codigo/T4/src/app.js) y [`codigo/T4/src/index.js`](../codigo/T4/src/index.js)

### 3.1 Servidor B√°sico

```javascript
// src/app.js
import express from 'express';

const app = express();

// Middleware para parsear JSON
app.use(express.json());

// Ruta de prueba
app.get('/', (req, res) => {
  res.json({ mensaje: 'API funcionando correctamente' });
});

// Ruta de health check
app.get('/health', (req, res) => {
  res.json({ 
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  });
});

export default app;
```

```javascript
// src/index.js
import app from './app.js';

const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
  console.log(`Servidor ejecut√°ndose en http://localhost:${PORT}`);
  console.log(`Entorno: ${process.env.NODE_ENV || 'development'}`);
});
```

### 3.2 Ejecutar el Servidor

```bash
# Desarrollo (con reinicio autom√°tico)
npm run dev

# Producci√≥n
npm start
```

---

## 4. Routing en Express 5

### 4.1 M√©todos HTTP

Express proporciona m√©todos para cada verbo HTTP:

```javascript
app.get('/recurso', handler);      // Obtener
app.post('/recurso', handler);     // Crear
app.put('/recurso/:id', handler);  // Reemplazar
app.patch('/recurso/:id', handler);// Modificar parcialmente
app.delete('/recurso/:id', handler);// Eliminar
app.all('/recurso', handler);      // Todos los m√©todos
```

### 4.2 Par√°metros de Ruta

```javascript
// Par√°metro obligatorio
app.get('/cursos/:id', (req, res) => {
  const { id } = req.params;
  res.json({ id });
});

// M√∫ltiples par√°metros
app.get('/cursos/:categoria/:id', (req, res) => {
  const { categoria, id } = req.params;
  res.json({ categoria, id });
});
```

**‚ö†Ô∏è Cambios en Express 5:**

```javascript
// Express 4 - Par√°metro opcional
app.get('/users/:id?', handler);

// Express 5 - Nueva sintaxis con llaves
app.get('/users{/:id}', handler);

// Express 4 - Wildcard an√≥nimo
app.get('/files/*', handler);

// Express 5 - Wildcard con nombre obligatorio
app.get('/files/*filepath', (req, res) => {
  console.log(req.params.filepath); // Captura todo despu√©s de /files/
});
```

### 4.3 Query Parameters

```javascript
// GET /cursos?nivel=basico&orden=vistas&limit=10
app.get('/cursos', (req, res) => {
  const { nivel, orden, limit } = req.query;
  
  console.log(nivel);  // 'basico'
  console.log(orden);  // 'vistas'
  console.log(limit);  // '10' (siempre string)
  
  res.json({ filtros: req.query });
});
```

### 4.4 Respuestas

```javascript
// JSON (m√°s com√∫n para APIs)
res.json({ data: usuarios });

// Con c√≥digo de estado
res.status(201).json({ mensaje: 'Creado', data: nuevo });
res.status(404).json({ error: 'No encontrado' });

// Sin contenido
res.status(204).end();

// Texto plano
res.send('Hola mundo');

// HTML
res.send('<h1>T√≠tulo</h1>');

// Archivo
res.sendFile('/ruta/archivo.pdf');

// Redirecci√≥n
res.redirect('/nueva-ruta');
res.redirect(301, '/nueva-ruta-permanente');
```

---

## 5. CRUD Completo

> üìÇ **C√≥digo de ejemplo**: [`codigo/T4/src/data/cursos.js`](../codigo/T4/src/data/cursos.js) y [`codigo/T4/src/controllers/cursos.controller.js`](../codigo/T4/src/controllers/cursos.controller.js)

### 5.1 Datos de Ejemplo

```javascript
// src/data/cursos.js
export const cursos = {
  programacion: [
    { id: 1, titulo: 'JavaScript Moderno', nivel: 'basico', vistas: 15000 },
    { id: 2, titulo: 'Node.js Avanzado', nivel: 'avanzado', vistas: 8500 },
    { id: 3, titulo: 'Python para Data Science', nivel: 'intermedio', vistas: 12000 }
  ],
  matematicas: [
    { id: 1, titulo: 'C√°lculo Diferencial', tema: 'calculo', nivel: 'basico', vistas: 7500 },
    { id: 2, titulo: '√Ålgebra Lineal', tema: 'algebra', nivel: 'intermedio', vistas: 6200 }
  ]
};
```

### 5.2 Controlador de Cursos

```javascript
// src/controllers/cursos.controller.js
import { cursos } from '../data/cursos.js';
import { ApiError } from '../middleware/errorHandler.js';

const programacion = cursos.programacion;

// GET /api/cursos/programacion
export const getAll = (req, res) => {
  let resultado = [...programacion];
  const { nivel, lenguaje, orden, limit, offset } = req.query;
  
  // Filtrar por nivel
  if (nivel) {
    resultado = resultado.filter(c => c.nivel === nivel);
  }
  
  // Ordenar
  if (orden === 'vistas') {
    resultado.sort((a, b) => b.vistas - a.vistas);
  } else if (orden === 'titulo') {
    resultado.sort((a, b) => a.titulo.localeCompare(b.titulo));
  }
  
  res.json(resultado);
};

// GET /api/cursos/programacion/:id
export const getById = (req, res) => {
  const id = parseInt(req.params.id);
  const curso = programacion.find(c => c.id === id);
  
  if (!curso) {
    throw ApiError.notFound(`Curso con ID ${id} no encontrado`);
  }
  
  res.json(curso);
};

// POST /api/cursos/programacion
export const create = (req, res) => {
  const { titulo, lenguaje, nivel, descripcion } = req.body;
  
  const nuevoCurso = {
    id: programacion.length + 1,
    titulo,
    lenguaje,
    nivel,
    descripcion: descripcion || null,
    vistas: 0
  };
  
  programacion.push(nuevoCurso);
  
  res.status(201).json(nuevoCurso);
};

// PUT /api/cursos/programacion/:id
export const update = (req, res) => {
  const id = parseInt(req.params.id);
  const index = programacion.findIndex(c => c.id === id);
  
  if (index === -1) {
    throw ApiError.notFound(`Curso con ID ${id} no encontrado`);
  }
  
  const { titulo, lenguaje, nivel, descripcion } = req.body;
  
  programacion[index] = {
    id,
    titulo,
    lenguaje,
    nivel,
    descripcion: descripcion || null,
    vistas: programacion[index].vistas
  };
  
  res.json(programacion[index]);
};

// PATCH /api/cursos/programacion/:id
export const partialUpdate = (req, res) => {
  const id = parseInt(req.params.id);
  const index = programacion.findIndex(c => c.id === id);
  
  if (index === -1) {
    throw ApiError.notFound(`Curso con ID ${id} no encontrado`);
  }
  
  programacion[index] = {
    ...programacion[index],
    ...req.body
  };
  
  res.json(programacion[index]);
};

// DELETE /api/cursos/programacion/:id
export const remove = (req, res) => {
  const id = parseInt(req.params.id);
  const index = programacion.findIndex(c => c.id === id);
  
  if (index === -1) {
    throw ApiError.notFound(`Curso con ID ${id} no encontrado`);
  }
  
  programacion.splice(index, 1);
  
  res.status(204).end();
};
```

---

## 6. Routers Modulares

> üìÇ **C√≥digo de ejemplo**: [`codigo/T4/src/routes/cursos.routes.js`](../codigo/T4/src/routes/cursos.routes.js) y [`codigo/T4/src/routes/index.js`](../codigo/T4/src/routes/index.js)

### 6.1 Router de Express

Los Routers permiten organizar rutas en m√≥dulos separados:

```javascript
// src/routes/cursos.routes.js
import { Router } from 'express';
import * as cursosController from '../controllers/cursos.controller.js';

const router = Router();

router.get('/', cursosController.getAll);
router.get('/:id', cursosController.getById);
router.post('/', cursosController.create);
router.put('/:id', cursosController.update);
router.patch('/:id', cursosController.partialUpdate);
router.delete('/:id', cursosController.remove);

export default router;
```

### 6.2 Agregador de Rutas

```javascript
// src/routes/index.js
import { Router } from 'express';
import cursosRoutes from './cursos.routes.js';

const router = Router();

router.use('/cursos/programacion', cursosRoutes);

router.get('/', (req, res) => {
  res.json({
    mensaje: 'API de Cursos v1.0',
    endpoints: {
      cursos: '/api/cursos/programacion',
      health: '/health'
    }
  });
});

export default router;
```

### 6.3 Integraci√≥n en App

```javascript
// src/app.js
import express from 'express';
import helmet from 'helmet';
import cors from 'cors';
import routes from './routes/index.js';
import { errorHandler, notFoundHandler } from './middleware/errorHandler.js';

const app = express();

// Seguridad
app.use(helmet());
app.use(cors());

// Parseo de body
app.use(express.json({ limit: '10kb' }));
app.use(express.urlencoded({ extended: true }));

// Health check
app.get('/health', (req, res) => {
  res.json({ status: 'ok' });
});

// Rutas de la API
app.use('/api', routes);

// Manejo de errores
app.use(notFoundHandler);
app.use(errorHandler);

export default app;
```

---

## 7. Middleware

### 7.1 ¬øQu√© es Middleware?

El middleware son funciones que se ejecutan **entre** la solicitud y la respuesta. Tienen acceso a `req`, `res` y `next()`.

```
Request ‚Üí Middleware 1 ‚Üí Middleware 2 ‚Üí ... ‚Üí Route Handler ‚Üí Response
```

### 7.2 Tipos de Middleware

```javascript
// Middleware de aplicaci√≥n
app.use(express.json());
app.use(helmet());

// Middleware de ruta
app.use('/api', authMiddleware, routes);

// Middleware inline
app.get('/admin', authMiddleware, adminMiddleware, handler);

// Middleware de error (4 par√°metros)
app.use((err, req, res, next) => {
  console.error(err);
  res.status(500).json({ error: 'Error interno' });
});
```

### 7.3 Middleware Com√∫n

```javascript
// src/middleware/logger.js
export const logger = (req, res, next) => {
  const timestamp = new Date().toISOString();
  console.log(`[${timestamp}] ${req.method} ${req.url}`);
  next();
};

// src/middleware/auth.js
export const authMiddleware = (req, res, next) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  
  if (!token) {
    return res.status(401).json({ error: 'Token requerido' });
  }
  
  // Verificar token...
  next();
};
```

### 7.4 Middleware de Terceros

```javascript
import express from 'express';
import helmet from 'helmet';
import cors from 'cors';
import compression from 'compression';

const app = express();

// Seguridad
app.use(helmet());

// CORS
app.use(cors({
  origin: ['http://localhost:5173'],
  credentials: true
}));

// Compresi√≥n
app.use(compression());

// Parseo de JSON
app.use(express.json({ limit: '10kb' }));
app.use(express.urlencoded({ extended: true }));
```

> ‚ö†Ô∏è **body-parser est√° deprecado**. Usa `express.json()` y `express.urlencoded()` directamente.

---

## 8. Validaci√≥n con Zod

> üìÇ **C√≥digo de ejemplo**: [`codigo/T4/src/schemas/cursos.schema.js`](../codigo/T4/src/schemas/cursos.schema.js) y [`codigo/T4/src/middleware/validateRequest.js`](../codigo/T4/src/middleware/validateRequest.js)

Zod es la librer√≠a de validaci√≥n m√°s popular en 2025, con ~65 millones de descargas semanales.

### 8.1 Instalaci√≥n

```bash
npm install zod
```

### 8.2 Definir Schemas

```javascript
// src/schemas/cursos.schema.js
import { z } from 'zod';

export const createCursoSchema = z.object({
  body: z.object({
    titulo: z.string()
      .min(3, 'El t√≠tulo debe tener al menos 3 caracteres')
      .max(100, 'El t√≠tulo no puede exceder 100 caracteres'),
    lenguaje: z.enum(['javascript', 'python', 'java', 'csharp']),
    nivel: z.enum(['basico', 'intermedio', 'avanzado']),
    descripcion: z.string().optional()
  })
});

export const updateCursoSchema = z.object({
  body: z.object({
    titulo: z.string().min(3).max(100).optional(),
    lenguaje: z.enum(['javascript', 'python', 'java', 'csharp']).optional(),
    nivel: z.enum(['basico', 'intermedio', 'avanzado']).optional(),
    descripcion: z.string().optional()
  }),
  params: z.object({
    id: z.string().regex(/^\d+$/, 'ID debe ser num√©rico')
  })
});
```

### 8.3 Middleware de Validaci√≥n

```javascript
// src/middleware/validateRequest.js
import { ZodError } from 'zod';

export const validate = (schema) => async (req, res, next) => {
  try {
    await schema.parseAsync({
      body: req.body,
      query: req.query,
      params: req.params
    });
    next();
  } catch (error) {
    if (error instanceof ZodError) {
      const errors = error.errors.map(err => ({
        campo: err.path.join('.'),
        mensaje: err.message
      }));
      
      return res.status(400).json({
        error: 'Error de validaci√≥n',
        detalles: errors
      });
    }
    next(error);
  }
};
```

### 8.4 Uso en Rutas

```javascript
// src/routes/cursos.routes.js
import { Router } from 'express';
import * as controller from '../controllers/cursos.controller.js';
import { validate } from '../middleware/validateRequest.js';
import { createCursoSchema, updateCursoSchema } from '../schemas/cursos.schema.js';

const router = Router();

router.get('/', controller.getAll);
router.get('/:id', controller.getById);
router.post('/', validate(createCursoSchema), controller.create);
router.put('/:id', validate(updateCursoSchema), controller.update);
router.patch('/:id', validate(updateCursoSchema), controller.partialUpdate);
router.delete('/:id', controller.remove);

export default router;
```

---

## 9. Manejo de Errores

> üìÇ **C√≥digo de ejemplo**: [`codigo/T4/src/middleware/errorHandler.js`](../codigo/T4/src/middleware/errorHandler.js)

### 9.1 Error Handler Global

```javascript
// src/middleware/errorHandler.js

export class ApiError extends Error {
  constructor(statusCode, message, details = null) {
    super(message);
    this.statusCode = statusCode;
    this.details = details;
    this.isOperational = true;
  }
  
  static badRequest(message, details) {
    return new ApiError(400, message, details);
  }
  
  static notFound(message = 'Recurso no encontrado') {
    return new ApiError(404, message);
  }
  
  static internal(message = 'Error interno del servidor') {
    return new ApiError(500, message);
  }
}

export const notFoundHandler = (req, res, next) => {
  res.status(404).json({
    error: 'Ruta no encontrada',
    path: req.originalUrl,
    method: req.method
  });
};

export const errorHandler = (err, req, res, next) => {
  console.error('Error:', err);
  
  if (err.isOperational) {
    return res.status(err.statusCode).json({
      error: err.message,
      ...(err.details && { detalles: err.details })
    });
  }
  
  const isDev = process.env.NODE_ENV === 'development';
  
  res.status(500).json({
    error: 'Error interno del servidor',
    ...(isDev && { stack: err.stack, message: err.message })
  });
};
```

---

## 10. Validaci√≥n de Entorno

> üìÇ **C√≥digo de ejemplo**: [`codigo/T4/src/config/env.js`](../codigo/T4/src/config/env.js)

```javascript
// src/config/env.js
import { z } from 'zod';

const envSchema = z.object({
  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
  PORT: z.string().regex(/^\d+$/).transform(Number).default('3000'),
  JWT_SECRET: z.string().min(32, 'JWT_SECRET debe tener al menos 32 caracteres')
});

const parsed = envSchema.safeParse(process.env);

if (!parsed.success) {
  console.error('‚ùå Variables de entorno inv√°lidas:');
  parsed.error.issues.forEach(issue => {
        console.error(`  - ${issue.path.join('.') || 'env'}: ${issue.message}`);
  });
  process.exit(1);
}

export const env = parsed.data;
```

---

## 11. Archivos Est√°ticos y Logging

### 11.1 Servir Archivos Est√°ticos

Express incluye middleware para servir archivos est√°ticos (im√°genes, CSS, JavaScript del cliente):

```javascript
import express from 'express';
import path from 'node:path';

const app = express();

// Servir carpeta 'public' en la ra√≠z
app.use(express.static('public'));
// Acceso: http://localhost:3000/imagen.png ‚Üí public/imagen.png

// Servir con prefijo de ruta
app.use('/static', express.static('public'));
// Acceso: http://localhost:3000/static/imagen.png ‚Üí public/imagen.png

// Ruta absoluta
app.use('/assets', express.static(path.join(import.meta.dirname, 'public')));
```

**Opciones √∫tiles:**

```javascript
app.use(express.static('public', {
  maxAge: '1d',        // Cache de 1 d√≠a
  etag: true,          // ETags para cache validation
  index: 'index.html', // Archivo por defecto
  extensions: ['html', 'htm']  // Probar extensiones si no se especifica
}));
```

### 11.2 Logging con Morgan

Morgan es el middleware de logging HTTP est√°ndar para Express:

```bash
npm install morgan
```

```javascript
import express from 'express';
import morgan from 'morgan';

const app = express();

// Formatos predefinidos
app.use(morgan('dev'));       // Desarrollo: coloreado y conciso
app.use(morgan('combined'));  // Producci√≥n: formato Apache
app.use(morgan('tiny'));      // M√≠nimo

// Condicional por entorno
if (process.env.NODE_ENV === 'development') {
  app.use(morgan('dev'));
}
```

**Formato `dev` output:**
```
GET /api/cursos 200 12.345 ms - 1234
POST /api/cursos 201 5.678 ms - 89
GET /api/cursos/999 404 1.234 ms - 45
```

**Logging a archivo en producci√≥n:**

```javascript
import morgan from 'morgan';
import fs from 'node:fs';
import path from 'node:path';

// Crear stream de escritura
const accessLogStream = fs.createWriteStream(
  path.join(import.meta.dirname, '..', 'logs', 'access.log'),
  { flags: 'a' }  // Append
);

// Usar en producci√≥n
app.use(morgan('combined', { stream: accessLogStream }));
```

---

## 12. Migraci√≥n de Express 4 a Express 5

```javascript
// Antes (Express 4)
app.del('/recurso/:id', handler);
res.sendfile('/path/to/file');
app.get('/users/:id?', handler);
app.get('/files/*', handler);

// Despu√©s (Express 5)
app.delete('/recurso/:id', handler);
res.sendFile('/path/to/file');
app.get('/users{/:id}', handler);
app.get('/files/*filepath', handler);
```

**Herramienta de migraci√≥n:**
```bash
npx @expressjs/codemod upgrade
```

**Tareas:**
- Prueba los endpoints de cursos/programacion con REST Client
- Haz lo mismo, un CRUD, con cursos/matem√°ticas y pru√©balo con REST Client

---

## Ejercicio del Curso

Para poner en pr√°ctica los conceptos de este tema, realiza el siguiente ejercicio:

### üìù Todo API con Express

Crea una API de tareas (todos) con Express, middleware personalizado y validaci√≥n con Zod.

**Ubicaci√≥n:** `ejercicios/T4/`

**Endpoints:**
| M√©todo | Ruta | Descripci√≥n |
|--------|------|-------------|
| GET | /api/todos | Listar (con filtros) |
| GET | /api/todos/:id | Obtener una |
| POST | /api/todos | Crear tarea |
| PUT | /api/todos/:id | Actualizar |
| DELETE | /api/todos/:id | Eliminar |
| PATCH | /api/todos/:id/toggle | Cambiar completada |

**Modelo de datos (Todo):**
| Campo | Tipo | Requerido | Descripci√≥n |
|-------|------|-----------|-------------|
| id | number | auto | Identificador √∫nico |
| title | string | s√≠ | T√≠tulo de la tarea (3-100 chars) |
| description | string | no | Descripci√≥n opcional |
| completed | boolean | no | Estado (default: false) |
| priority | enum | no | "low", "medium", "high" (default: "medium") |
| createdAt | string | auto | Fecha de creaci√≥n ISO |

**Filtros disponibles (query params):**
- `?completed=true|false` - Filtrar por estado
- `?priority=low|medium|high` - Filtrar por prioridad

**Conceptos a aplicar:**
- Express 5 con estructura modular
- Middleware de logging con timestamps
- Validaci√≥n con Zod en todas las rutas
- Filtros por query parameters
- Manejo centralizado de errores

```bash
cd ejercicios/T4
npm install
npm run dev
```

Consulta el README del ejercicio para m√°s detalles.

---

## Resumen

| Concepto | Descripci√≥n |
|----------|-------------|
| Express 5 | Framework web con async/await autom√°tico |
| Router | Modularizaci√≥n de rutas |
| Middleware | Funciones entre request y response |
| Zod | Validaci√≥n de datos |
| `--watch` | Reinicio autom√°tico nativo |
| `--env-file` | Variables de entorno nativas |
| ESM | M√≥dulos ES6 (`import`/`export`) |

---

## Recursos Adicionales

- [Express 5 - Documentaci√≥n oficial](https://expressjs.com/)
- [Express 5 - Gu√≠a de migraci√≥n](https://expressjs.com/en/guide/migrating-5.html)
- [Zod - Documentaci√≥n](https://zod.dev/)
- [Helmet - Seguridad](https://helmetjs.github.io/)
- [Morgan - Logging](https://github.com/expressjs/morgan)
- [Node.js Best Practices](https://github.com/goldbergyoni/nodebestpractices)

### Pr√≥ximo tema

En el **Tema 5 - Bases de Datos con MongoDB** veremos:
- MongoDB y bases de datos NoSQL
- Mongoose como ODM
- Modelos y esquemas
- Operaciones CRUD con MongoDB
- Relaciones entre documentos

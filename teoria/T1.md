# Tema 1: Fundamentos Modernos de Desarrollo Backend con Node.js

## √çndice

1. [Introducci√≥n al Backend Web](#1-introducci√≥n-al-backend-web)
2. [Node.js en 2025](#2-nodejs-en-2025)
3. [Configuraci√≥n del Entorno Profesional](#3-configuraci√≥n-del-entorno-profesional)
4. [Sistema de M√≥dulos: ESM como Est√°ndar](#4-sistema-de-m√≥dulos-esm-como-est√°ndar)
5. [I/O As√≠ncrono con Promesas](#5-io-as√≠ncrono-con-promesas)
6. [M√≥dulos Core de Node.js](#6-m√≥dulos-core-de-nodejs)
7. [Gesti√≥n de Paquetes con npm](#7-gesti√≥n-de-paquetes-con-npm)
8. [Tooling Nativo y Experiencia de Desarrollo](#8-tooling-nativo-y-experiencia-de-desarrollo)
9. [Servidor HTTP Nativo](#9-servidor-http-nativo)
10. [Seguridad por Dise√±o](#10-seguridad-por-dise√±o)
11. [Panorama de Frameworks](#11-panorama-de-frameworks)

---

## 1. Introducci√≥n al Backend Web

### Arquitectura Cliente-Servidor

El modelo cliente-servidor es la base de la web moderna. En este modelo:

- **Cliente**: Dispositivo que solicita recursos (navegador, app m√≥vil, otro servidor)
- **Servidor**: M√°quina que procesa peticiones y env√≠a respuestas
- **Protocolo**: Reglas de comunicaci√≥n entre ambos (HTTP/HTTPS)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         Petici√≥n HTTP          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ             ‚îÇ
‚îÇ   Cliente   ‚îÇ                                ‚îÇ   Servidor  ‚îÇ
‚îÇ (Navegador) ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ  (Node.js)  ‚îÇ
‚îÇ             ‚îÇ         Respuesta HTTP         ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                     ‚îÇ
                                                     ‚ñº
                                               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                               ‚îÇ   Base de   ‚îÇ
                                               ‚îÇ    Datos    ‚îÇ
                                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Frontend vs Backend vs Full-Stack

| √Årea | Responsabilidad | Tecnolog√≠as t√≠picas |
|------|-----------------|---------------------|
| **Frontend** | Interfaz de usuario, interacci√≥n | React, Vue, HTML/CSS/JS |
| **Backend** | L√≥gica de negocio, datos, APIs | Node.js, Express, bases de datos |
| **Full-Stack** | Ambas √°reas | Todo lo anterior |

Como ya domin√°is React en el frontend, ahora aprender√©is a construir el servidor que alimenta esas aplicaciones.

### ¬øQu√© hace un servidor backend?

- Procesa peticiones HTTP (GET, POST, PUT, DELETE)
- Autentica y autoriza usuarios
- Valida datos de entrada
- Ejecuta l√≥gica de negocio
- Interact√∫a con bases de datos
- Responde con datos (JSON) o p√°ginas renderizadas

---

## 2. Node.js en 2025

### ¬øQu√© es Node.js?

Node.js es un **entorno de ejecuci√≥n de JavaScript** fuera del navegador, basado en el motor V8 de Chrome. Permite ejecutar JavaScript en el servidor.

```javascript
// Antes de Node.js: JavaScript solo en el navegador
// Ahora: JavaScript tambi√©n en el servidor, CLI, IoT...
```

### Caracter√≠sticas principales

- **As√≠ncrono y orientado a eventos**: No bloquea operaciones I/O
- **Single-threaded con Event Loop**: Un hilo principal + pool de workers
- **Motor V8**: Compila JS a c√≥digo m√°quina (alta performance)
- **Ecosistema npm**: El mayor registro de paquetes del mundo

### Versiones LTS actuales

| Versi√≥n | Codename | Estado | Fin de soporte |
|---------|----------|--------|----------------|
| Node.js 24 | Krypton | **Active LTS** ‚úÖ | Abril 2028 |
| Node.js 22 | Jod | Maintenance LTS | Abril 2027 |
| Node.js 20 | Iron | Maintenance LTS | Abril 2026 |

> **Recomendaci√≥n**: Usar siempre la versi√≥n **Active LTS** en producci√≥n y para aprender.

### Arquitectura: V8 + Libuv

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Tu c√≥digo JS                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     Node.js APIs                        ‚îÇ
‚îÇ            (fs, http, crypto, path, etc.)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚ñº                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         V8          ‚îÇ       ‚îÇ         Libuv           ‚îÇ
‚îÇ   (Motor JS, C++)   ‚îÇ       ‚îÇ   (I/O as√≠ncrono, C)    ‚îÇ
‚îÇ   - Compila JS      ‚îÇ       ‚îÇ   - Event Loop          ‚îÇ
‚îÇ   - Call Stack      ‚îÇ       ‚îÇ   - Thread Pool (4)     ‚îÇ
‚îÇ   - Heap            ‚îÇ       ‚îÇ   - File system         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ   - Network             ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**¬øPor qu√© es importante entender esto?**

- V8 ejecuta tu c√≥digo JavaScript en un **√∫nico hilo**
- Libuv maneja las operaciones I/O en **m√∫ltiples hilos** en segundo plano
- El Event Loop coordina todo, permitiendo alta concurrencia sin bloqueos

### Event Loop (introducci√≥n)

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/02-event-loop.js`](../codigo/T1/src/02-event-loop.js)

```javascript
// C√≥digo s√≠ncrono: bloquea el Event Loop
console.log('1');
console.log('2');
console.log('3');
// Output: 1, 2, 3

// C√≥digo as√≠ncrono: no bloquea
console.log('1');
setTimeout(() => console.log('2'), 0);
console.log('3');
// Output: 1, 3, 2
```

El Event Loop procesa:
1. C√≥digo s√≠ncrono (Call Stack)
2. Microtasks (Promises, process.nextTick)
3. Macrotasks (setTimeout, setInterval, I/O)

> üìö **Profundizaci√≥n**: Ver **Tema 2 - Eventos y Asincron√≠a** para el funcionamiento detallado del Event Loop, sus 6 fases, microtasks vs macrotasks, y patrones avanzados de concurrencia.

---

## 3. Configuraci√≥n del Entorno Profesional

### Instalaci√≥n de Node.js

1. Descargar desde [nodejs.org](https://nodejs.org) la versi√≥n **LTS**
2. Verificar instalaci√≥n:

```bash
node --version   # v24.x.x
npm --version    # 11.x.x
```

### Estructura de proyecto moderna

```
mi-proyecto/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js           # Punto de entrada
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ .env                   # Variables de entorno (NO commitear)
‚îú‚îÄ‚îÄ .env.example           # Plantilla de variables
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

### Inicializar un proyecto

```bash
# Crear directorio y entrar
mkdir mi-api && cd mi-api

# Inicializar con valores por defecto
npm init -y
```

### package.json moderno (2025)

```json
{
  "name": "mi-api",
  "version": "1.0.0",
  "description": "API REST con Node.js",
  "type": "module",
  "main": "src/index.js",
  "scripts": {
    "dev": "node --watch --env-file=.env src/index.js",
    "start": "node --env-file=.env src/index.js",
    "test": "node --test"
  },
  "engines": {
    "node": ">=22.0.0"
  },
  "keywords": [],
  "author": "Tu nombre",
  "license": "MIT"
}
```

**Puntos clave:**

- `"type": "module"`: Activa ESM (ECMAScript Modules)
- `"engines"`: Especifica versi√≥n m√≠nima de Node.js
- `--watch`: Reinicio autom√°tico nativo (sin nodemon)
- `--env-file`: Carga de variables de entorno nativa (sin dotenv)

---

## 4. Sistema de M√≥dulos: ESM como Est√°ndar

### CommonJS vs ECMAScript Modules

Node.js soporta dos sistemas de m√≥dulos. **ESM es el est√°ndar actual**.

| Caracter√≠stica | CommonJS (Legado) | ESM (Moderno) ‚úÖ |
|----------------|-------------------|------------------|
| Sintaxis | `require()` / `module.exports` | `import` / `export` |
| Carga | S√≠ncrona, bloqueante | As√≠ncrona |
| An√°lisis | Din√°mico (runtime) | Est√°tico (permite tree-shaking) |
| Top-level await | ‚ùå No | ‚úÖ S√≠ |
| Compatibilidad | Solo Node.js | Node.js + Navegadores |

### Sintaxis ESM

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/03-esm-modules.js`](../codigo/T1/src/03-esm-modules.js)

```javascript
// math.js - Exportar
export const sumar = (a, b) => a + b;
export const restar = (a, b) => a - b;

// Tambi√©n export por defecto
export default class Calculadora {
  // ...
}
```

```javascript
// app.js - Importar
import Calculadora, { sumar, restar } from './math.js';

// Importar todo como namespace
import * as math from './math.js';
console.log(math.sumar(2, 3));
```

### Activar ESM en tu proyecto

**Opci√≥n 1**: En package.json (recomendado)
```json
{
  "type": "module"
}
```

**Opci√≥n 2**: Usar extensi√≥n `.mjs`

### Top-Level Await

Una de las ventajas de ESM es poder usar `await` fuera de funciones async:

```javascript
// CommonJS: necesitabas envolver en IIFE
(async () => {
  const data = await fetchData();
  console.log(data);
})();

// ESM: directo y limpio
const data = await fetchData();
console.log(data);
```

### Importar JSON en ESM

```javascript
// Opci√≥n 1: Import assertion (est√°ndar)
import config from './config.json' with { type: 'json' };

// Opci√≥n 2: fs/promises
import { readFile } from 'node:fs/promises';
const config = JSON.parse(
  await readFile('./config.json', 'utf-8')
);
```

---

## 5. I/O As√≠ncrono con Promesas

### El problema de los callbacks

El patr√≥n tradicional de Node.js usaba callbacks con "error-first":

```javascript
// ‚ùå Callback Hell - NO USAR
import fs from 'node:fs';

fs.readFile('archivo1.txt', 'utf-8', (err, data1) => {
  if (err) {
    console.error(err);
    return;
  }
  fs.readFile('archivo2.txt', 'utf-8', (err, data2) => {
    if (err) {
      console.error(err);
      return;
    }
    fs.writeFile('resultado.txt', data1 + data2, (err) => {
      if (err) {
        console.error(err);
        return;
      }
      console.log('Completado');
    });
  });
});
```

### La soluci√≥n: async/await con Promesas

```javascript
// ‚úÖ Moderno y legible
import { readFile, writeFile } from 'node:fs/promises';

try {
  const data1 = await readFile('archivo1.txt', 'utf-8');
  const data2 = await readFile('archivo2.txt', 'utf-8');
  await writeFile('resultado.txt', data1 + data2);
  console.log('Completado');
} catch (error) {
  console.error('Error:', error.message);
}
```

### Operaciones en paralelo

```javascript
import { readFile } from 'node:fs/promises';

// Secuencial (lento): espera cada archivo
const data1 = await readFile('archivo1.txt', 'utf-8');
const data2 = await readFile('archivo2.txt', 'utf-8');

// Paralelo (r√°pido): lee todos a la vez
const [file1, file2, file3] = await Promise.all([
  readFile('archivo1.txt', 'utf-8'),
  readFile('archivo2.txt', 'utf-8'),
  readFile('archivo3.txt', 'utf-8')
]);
```

> üìö **Profundizaci√≥n**: Ver **Tema 2** para `Promise.allSettled()`, `Promise.any()`, `Promise.race()`, patrones de concurrencia controlada, y manejo avanzado de errores con `Error.cause` y `AggregateError`.

---

## 6. M√≥dulos Core de Node.js

Node.js incluye m√≥dulos integrados que no necesitan instalaci√≥n. Usa siempre el **protocolo `node:`** para importarlos.

### ¬øPor qu√© usar el protocolo `node:`?

```javascript
// ‚ùå Legado - puede colisionar con paquetes npm
import fs from 'fs';

// ‚úÖ Moderno - expl√≠cito y seguro
import fs from 'node:fs';
```

**Ventajas:**
- Evita "dependency confusion" (paquetes maliciosos con mismo nombre)
- M√°s r√°pido (no busca en node_modules)
- Claridad: sabes inmediatamente que es un m√≥dulo core

### node:fs/promises - Sistema de archivos

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/04-fs-promises.js`](../codigo/T1/src/04-fs-promises.js)

```javascript
import { 
  readFile, 
  writeFile, 
  mkdir, 
  readdir,
  stat,
  unlink,
  rename
} from 'node:fs/promises';

// Leer archivo
const contenido = await readFile('datos.json', 'utf-8');
const datos = JSON.parse(contenido);

// Escribir archivo
await writeFile('salida.json', JSON.stringify(datos, null, 2));

// Crear directorio (recursivo)
await mkdir('ruta/a/directorio', { recursive: true });

// Listar directorio
const archivos = await readdir('./src');
console.log(archivos);

// Informaci√≥n de archivo
const info = await stat('archivo.txt');
console.log(`Tama√±o: ${info.size} bytes`);
console.log(`Es directorio: ${info.isDirectory()}`);

// Eliminar archivo
await unlink('archivo-temporal.txt');

// Renombrar/mover
await rename('viejo.txt', 'nuevo.txt');
```

### node:path - Rutas de archivos

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/05-path-examples.js`](../codigo/T1/src/05-path-examples.js)

```javascript
import path from 'node:path';

// Unir rutas (multiplataforma)
const ruta = path.join('src', 'controllers', 'user.js');
// Linux/Mac: 'src/controllers/user.js'
// Windows: 'src\\controllers\\user.js'

// Ruta absoluta
const absoluta = path.resolve('src', 'index.js');
// /Users/usuario/proyecto/src/index.js

// Extraer partes
console.log(path.dirname('/app/src/index.js'));   // '/app/src'
console.log(path.basename('/app/src/index.js'));  // 'index.js'
console.log(path.extname('/app/src/index.js'));   // '.js'

// Parsear ruta completa
const parsed = path.parse('/app/src/index.js');
// { root: '/', dir: '/app/src', base: 'index.js', ext: '.js', name: 'index' }
```

### __dirname y __filename en ESM

En ESM no existen `__dirname` ni `__filename`. Desde Node.js 20.11+ puedes usar:

```javascript
// ‚úÖ Moderno (Node.js 20.11+)
const __dirname = import.meta.dirname;
const __filename = import.meta.filename;

// Ruta relativa al archivo actual
import { join } from 'node:path';
const configPath = join(import.meta.dirname, '..', 'config', 'app.json');
```

**Alternativa para versiones anteriores:**

```javascript
// Node.js < 20.11
import { fileURLToPath } from 'node:url';
import { dirname } from 'node:path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);
```

### node:os - Sistema operativo

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/06-os-info.js`](../codigo/T1/src/06-os-info.js)

```javascript
import os from 'node:os';

console.log('Sistema:', os.type());           // 'Darwin', 'Linux', 'Windows_NT'
console.log('Plataforma:', os.platform());    // 'darwin', 'linux', 'win32'
console.log('Arquitectura:', os.arch());      // 'x64', 'arm64'
console.log('CPUs:', os.cpus().length);
console.log('Memoria total:', os.totalmem() / 1024 / 1024 / 1024, 'GB');
console.log('Memoria libre:', os.freemem() / 1024 / 1024 / 1024, 'GB');
console.log('Home:', os.homedir());
console.log('Temp:', os.tmpdir());
console.log('Uptime:', os.uptime() / 3600, 'horas');
```

### node:crypto - Criptograf√≠a

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/07-crypto-examples.js`](../codigo/T1/src/07-crypto-examples.js)

```javascript
import { randomBytes, randomUUID, createHash, scrypt } from 'node:crypto';

// Generar UUID v4
const id = randomUUID();
// '550e8400-e29b-41d4-a716-446655440000'

// Bytes aleatorios
const token = randomBytes(32).toString('hex');

// Hash SHA-256
const hash = createHash('sha256')
  .update('mi mensaje')
  .digest('hex');

// Hash de contrase√±a con scrypt (recomendado)
const hashPassword = (password) => {
  return new Promise((resolve, reject) => {
    const salt = randomBytes(16).toString('hex');
    scrypt(password, salt, 64, (err, derivedKey) => {
      if (err) reject(err);
      resolve(`${salt}:${derivedKey.toString('hex')}`);
    });
  });
};
```

### node:process - Proceso actual

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/08-process-info.js`](../codigo/T1/src/08-process-info.js)

```javascript
// Variables de entorno
console.log(process.env.NODE_ENV);
console.log(process.env.DATABASE_URL);

// Argumentos de l√≠nea de comandos
// node app.js --port 3000 --verbose
console.log(process.argv);
// ['node', '/path/to/app.js', '--port', '3000', '--verbose']

// Directorio de trabajo
console.log(process.cwd());

// Uso de memoria
const memoria = process.memoryUsage();
console.log(`Heap usado: ${memoria.heapUsed / 1024 / 1024} MB`);

// Salir del proceso
process.exit(0);  // √âxito
process.exit(1);  // Error
```

### Timers

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/09-timers.js`](../codigo/T1/src/09-timers.js)

```javascript
// setTimeout: ejecutar una vez despu√©s de X ms
const timeoutId = setTimeout(() => {
  console.log('Ejecutado despu√©s de 2 segundos');
}, 2000);

// clearTimeout: cancelar
clearTimeout(timeoutId);

// setInterval: ejecutar cada X ms
let contador = 0;
const intervalId = setInterval(() => {
  contador++;
  console.log(`Tick ${contador}`);
  if (contador >= 5) {
    clearInterval(intervalId);
  }
}, 1000);

// setImmediate: ejecutar en la siguiente iteraci√≥n del Event Loop
setImmediate(() => {
  console.log('Ejecutado inmediatamente (despu√©s del c√≥digo s√≠ncrono)');
});

console.log('Esto se imprime primero');
```

---

## 7. Gesti√≥n de Paquetes con npm

### ¬øQu√© es npm?

npm (Node Package Manager) es:
1. **Registro**: Repositorio p√∫blico de paquetes JavaScript
2. **CLI**: Herramienta de l√≠nea de comandos
3. **Sitio web**: [npmjs.com](https://www.npmjs.com)

### Comandos esenciales

```bash
# Inicializar proyecto
npm init -y

# Instalar dependencia de producci√≥n
npm install express

# Instalar dependencia de desarrollo
npm install -D eslint

# Instalar versi√≥n espec√≠fica
npm install express@5.0.0

# Instalar todas las dependencias (de package.json)
npm install

# Actualizar paquetes
npm update

# Ver paquetes desactualizados
npm outdated

# Desinstalar paquete
npm uninstall express

# Ejecutar script
npm run dev
npm test  # shortcut para npm run test
npm start # shortcut para npm run start

# Ver √°rbol de dependencias
npm ls
npm ls --depth=0
```

### package.json en detalle

```json
{
  "name": "mi-api",
  "version": "1.0.0",
  "description": "API REST de ejemplo",
  "type": "module",
  "main": "src/index.js",
  "scripts": {
    "dev": "node --watch --env-file=.env src/index.js",
    "start": "node --env-file=.env src/index.js",
    "test": "node --test",
    "lint": "eslint ."
  },
  "dependencies": {
    "express": "^5.0.0",
    "zod": "^3.23.0"
  },
  "devDependencies": {
    "eslint": "^9.12.0"
  },
  "engines": {
    "node": ">=22.0.0"
  }
}
```

### Semver: Versionado Sem√°ntico

```
MAJOR.MINOR.PATCH
  ‚îÇ     ‚îÇ     ‚îÇ
  ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ Correcci√≥n de bugs (compatible)
  ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Nueva funcionalidad (compatible)
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Cambios incompatibles (breaking changes)
```

**Rangos de versi√≥n en package.json:**

| S√≠mbolo | Significado | Ejemplo |
|---------|-------------|---------|
| `^` | Compatible con MINOR | `^5.0.0` ‚Üí `5.x.x` |
| `~` | Compatible con PATCH | `~5.0.0` ‚Üí `5.0.x` |
| `>=` | Mayor o igual | `>=5.0.0` |
| Sin s√≠mbolo | Versi√≥n exacta | `5.0.0` |

### package-lock.json

- Generado autom√°ticamente
- Bloquea versiones exactas de todas las dependencias
- **Siempre commitear** al repositorio
- Garantiza instalaciones reproducibles

### node_modules

- Contiene todas las dependencias instaladas
- **Nunca commitear** (a√±adir a .gitignore)
- Se regenera con `npm install`

```gitignore
# .gitignore
node_modules/
dist/
.env
*.log
```

---

## 8. Tooling Nativo y Experiencia de Desarrollo

### Hot Reloading sin dependencias: --watch

Node.js incluye hot reloading nativo desde la versi√≥n 18:

```bash
# Reinicia autom√°ticamente al detectar cambios
node --watch src/index.js
```

**Antes (con nodemon):**
```bash
npm install -D nodemon
npx nodemon src/index.js
```

**Ahora (nativo):**
```bash
node --watch src/index.js
```

### Variables de entorno sin dotenv: --env-file

```bash
# Carga .env autom√°ticamente
node --env-file=.env src/index.js

# M√∫ltiples archivos
node --env-file=.env --env-file=.env.local src/index.js
```

**.env**
```
NODE_ENV=development
PORT=3000
DATABASE_URL=postgresql://localhost:5432/mydb
JWT_SECRET=mi-secreto-super-seguro
```

**Acceder a variables:**
```javascript
const port = process.env.PORT || 3000;
const dbUrl = process.env.DATABASE_URL;
```

### Script de desarrollo moderno

```json
{
  "scripts": {
    "dev": "node --watch --env-file=.env src/index.js",
    "start": "node --env-file=.env src/index.js"
  }
}
```

### Test Runner Nativo: node:test

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/math.test.js`](../codigo/T1/src/math.test.js)

Desde Node.js 20, el test runner nativo es estable y completo:

```javascript
// tests/math.test.js
import { describe, it, before, after, mock } from 'node:test';
import assert from 'node:assert';
import { sumar, restar } from '../src/math.js';

describe('Operaciones matem√°ticas', () => {
  it('debe sumar dos n√∫meros', () => {
    assert.strictEqual(sumar(2, 3), 5);
  });

  it('debe restar dos n√∫meros', () => {
    assert.strictEqual(restar(5, 3), 2);
  });

  it('debe manejar n√∫meros negativos', () => {
    assert.strictEqual(sumar(-1, 1), 0);
  });
});

describe('Funciones as√≠ncronas', () => {
  it('debe resolver promesas', async () => {
    const resultado = await Promise.resolve(42);
    assert.strictEqual(resultado, 42);
  });
});
```

**Ejecutar tests:**
```bash
# Ejecutar todos los tests
node --test

# Con watch mode
node --test --watch

# Con cobertura
node --test --experimental-test-coverage

# Patr√≥n espec√≠fico
node --test tests/**/*.test.js
```

### Comparativa: node:test vs Jest vs Vitest

| Caracter√≠stica | node:test | Jest | Vitest |
|----------------|-----------|------|--------|
| Instalaci√≥n | Incluido | npm | npm |
| Velocidad | ‚ö° Muy r√°pido | Lento | ‚ö° Muy r√°pido |
| Watch mode | ‚úÖ | ‚úÖ | ‚úÖ |
| Mocking | ‚úÖ | ‚úÖ | ‚úÖ |
| Cobertura | Experimental | ‚úÖ | ‚úÖ |

**Recomendaci√≥n:**
- Proyectos simples ‚Üí `node:test`
- Proyectos complejos ‚Üí **Jest** o **Vitest**

---

## 9. Servidor HTTP Nativo

### Crear servidor b√°sico con node:http

> üìÇ **C√≥digo de ejemplo**: [`codigo/T1/src/10-http-server.js`](../codigo/T1/src/10-http-server.js)

```javascript
import http from 'node:http';

const server = http.createServer((req, res) => {
  // req: informaci√≥n de la petici√≥n
  // res: objeto para enviar respuesta
  
  console.log(`${req.method} ${req.url}`);
  
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('¬°Hola desde Node.js!');
});

const PORT = process.env.PORT || 3000;

server.listen(PORT, () => {
  console.log(`Servidor escuchando en http://localhost:${PORT}`);
});
```

### Routing b√°sico

```javascript
import http from 'node:http';

const server = http.createServer((req, res) => {
  const { method, url } = req;
  
  // Configurar headers comunes
  res.setHeader('Content-Type', 'application/json');
  
  // Routing manual
  if (method === 'GET' && url === '/') {
    res.writeHead(200);
    res.end(JSON.stringify({ message: 'Bienvenido a la API' }));
  } 
  else if (method === 'GET' && url === '/usuarios') {
    res.writeHead(200);
    res.end(JSON.stringify([
      { id: 1, nombre: 'Ana' },
      { id: 2, nombre: 'Carlos' }
    ]));
  }
  else if (method === 'POST' && url === '/usuarios') {
    let body = '';
    
    req.on('data', chunk => {
      body += chunk.toString();
    });
    
    req.on('end', () => {
      const usuario = JSON.parse(body);
      res.writeHead(201);
      res.end(JSON.stringify({ 
        id: 3, 
        ...usuario,
        mensaje: 'Usuario creado' 
      }));
    });
  }
  else {
    res.writeHead(404);
    res.end(JSON.stringify({ error: 'Ruta no encontrada' }));
  }
});

server.listen(3000);
```

### fetch nativo para peticiones HTTP

Desde Node.js 18, `fetch` est√° disponible globalmente:

```javascript
// GET request
const response = await fetch('https://jsonplaceholder.typicode.com/users');
const usuarios = await response.json();
console.log(usuarios);

// POST request
const nuevoUsuario = await fetch('https://api.example.com/users', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer mi-token'
  },
  body: JSON.stringify({
    nombre: 'Ana Garc√≠a',
    email: 'ana@example.com'
  })
});

const resultado = await nuevoUsuario.json();
console.log(resultado);

// Manejo de errores
try {
  const res = await fetch('https://api.example.com/data');
  if (!res.ok) {
    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
  }
  const data = await res.json();
} catch (error) {
  console.error('Error en la petici√≥n:', error.message);
}
```

---

## 10. Seguridad por Dise√±o

### Validaci√≥n de variables de entorno con Zod

Nunca conf√≠es en que las variables de entorno existen o tienen el formato correcto:

```bash
npm install zod
```

```javascript
// src/config/env.js
import { z } from 'zod';

const envSchema = z.object({
  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
  PORT: z.coerce.number().default(3000),
  DATABASE_URL: z.string().url(),
  JWT_SECRET: z.string().min(32, 'JWT_SECRET debe tener al menos 32 caracteres'),
  CORS_ORIGIN: z.string().url().optional(),
});

// Parsear y validar - falla inmediatamente si hay errores
export const env = envSchema.parse(process.env);
```

```javascript
// src/index.js
import { env } from './config/env.js';

console.log(`Servidor en modo ${env.NODE_ENV}`);
console.log(`Puerto: ${env.PORT}`);
```

### Permission Model (Node.js 20+)

Restringe lo que tu aplicaci√≥n puede hacer:

```bash
# Solo lectura del directorio /app
node --experimental-permission --allow-fs-read=/app src/index.js

# Lectura y escritura limitada
node --experimental-permission \
  --allow-fs-read=/app \
  --allow-fs-write=/app/logs \
  src/index.js

# Sin acceso a red
node --experimental-permission \
  --allow-fs-read=/app \
  src/index.js

# Acceso espec√≠fico a red
node --experimental-permission \
  --allow-net=api.example.com \
  src/index.js
```

### Buenas pr√°cticas de seguridad

1. **Nunca commitear secretos**
   ```gitignore
   .env
   .env.local
   *.pem
   *.key
   ```

2. **Usar el protocolo node: para imports core**
   ```javascript
   // ‚úÖ Seguro
   import fs from 'node:fs';
   
   // ‚ùå Puede ser suplantado
   import fs from 'fs';
   ```

3. **Validar toda entrada de usuario**
   ```javascript
   import { z } from 'zod';

   const usuarioSchema = z.object({
     email: z.string().email(),
     password: z.string().min(8),
     edad: z.number().int().positive().max(120)
   });

   // En el handler
   const resultado = usuarioSchema.safeParse(req.body);
   if (!resultado.success) {
     return res.status(400).json({ errors: resultado.error.errors });
   }
   ```

4. **Mantener dependencias actualizadas**
   ```bash
   npm audit          # Ver vulnerabilidades
   npm audit fix      # Corregir autom√°ticamente
   npm outdated       # Ver versiones desactualizadas
   ```

---

## 11. Panorama de Frameworks

### Express.js: El est√°ndar de la industria

Express 5 (estable desde octubre 2024) es el framework m√°s utilizado:

```bash
npm install express
```

```javascript
import express from 'express';

const app = express();

app.use(express.json());

app.get('/', (req, res) => {
  res.json({ message: 'Hola desde Express 5' });
});

app.listen(3000, () => {
  console.log('Servidor en http://localhost:3000');
});
```

**Lo veremos en profundidad en el Tema 4.**

### Fastify: Rendimiento superior

Fastify ofrece 2-5x mejor rendimiento que Express:

```javascript
import Fastify from 'fastify';

const app = Fastify({ logger: true });

app.get('/', async () => {
  return { message: 'Hola desde Fastify' };
});

await app.listen({ port: 3000 });
```

### NestJS: Arquitectura empresarial

NestJS es un framework que a√±ade estructura y patrones de dise√±o sobre Express/Fastify. Usa decoradores y est√° orientado a aplicaciones empresariales grandes.

**Conceptos clave de NestJS:**
- **Decoradores**: `@Controller()`, `@Get()`, `@Injectable()`
- **Inyecci√≥n de dependencias**: El framework instancia y conecta servicios
- **M√≥dulos**: Organizan la aplicaci√≥n en features cohesivos

> **Nota**: NestJS est√° dise√±ado para TypeScript. En este curso nos enfocaremos en Express con JavaScript.

### Comparativa de frameworks

| Framework | Descargas/semana | Uso principal | Learning curve |
|-----------|------------------|---------------|----------------|
| Express | ~47M | APIs simples, prototipos | Baja |
| Fastify | ~3M | APIs de alto rendimiento | Media |
| NestJS | ~4M | Aplicaciones empresariales | Alta |
| Hono | ~500K | Edge computing, serverless | Baja |

**En este curso usaremos Express** por ser el est√°ndar de la industria, su amplia documentaci√≥n y comunidad.

---

## Ejercicio Pr√°ctico

Para poner en pr√°ctica los conceptos de este tema, realiza el siguiente ejercicio:

### üì¶ Package Analyzer CLI

Crea una herramienta CLI que analice proyectos Node.js y genere un informe sobre sus dependencias.

**Ubicaci√≥n:** `ejercicios/T1/`

**Requisitos:**
1. Leer el `package.json` del directorio actual o uno especificado por argumento
2. Mostrar informaci√≥n del proyecto (nombre, versi√≥n, scripts)
3. Analizar dependencias (prod vs dev, versiones, scoped packages)
4. Generar un informe en `analysis-report.json`

**Conceptos a aplicar:**
- ESM (import/export)
- `process.argv` para argumentos
- `node:fs/promises` para leer/escribir archivos
- `node:path` para rutas multiplataforma
- Manejo de errores con try/catch

```bash
cd ejercicios/T1
node src/analyzer.js
```

Consulta el README del ejercicio para m√°s detalles.

---

## Recursos adicionales

### Documentaci√≥n oficial

- [Node.js Docs](https://nodejs.org/docs/latest/api/)
- [MDN JavaScript](https://developer.mozilla.org/es/docs/Web/JavaScript)
- [Express.js](https://expressjs.com/)

### Herramientas recomendadas

- **Editor**: VS Code con extensiones ESLint, Prettier, Thunder Client
- **Terminal**: Warp, iTerm2, Windows Terminal
- **Gesti√≥n de versiones Node**: nvm, fnm

### Pr√≥ximo tema

En el **Tema 2 - Eventos y Asincron√≠a** profundizaremos en:
- Event Loop en detalle (6 fases)
- EventEmitter y patrones de eventos
- Promesas avanzadas (allSettled, any, race)
- AbortController y cancelaci√≥n
- AsyncLocalStorage para contexto

---

*√öltima actualizaci√≥n: Diciembre 2025*
